---
- name: Call config template with parameters
  include: template_new_web_config.yml
  vars:
    web_config_name: "{{ item.name }}"
    web_server_hostname: "{{ item.servername }}"
    web_server_port: "{{ item.portnum }}"
  with_items: "{{ web_proxies_enabled }}"
  when: item.servername is defined

- name: Enable web modules
  apache2_module:
    state: present
    name: "{{ item.name }}"
  with_items: "{{ web_mods_enabled }}"
  become: true
  notify: reload apache2 config

- name: Enable web configs
  command:
    argv:
      - /usr/sbin/a2enconf
      - "{{ item.name }}"
  with_items: "{{ web_configs_enabled }}"
  become: true
  notify: reload apache2 config

- name: Enable web sites
  command:
    argv:
      - /usr/sbin/a2ensite
      - "{{ item.name }}"
  with_items: "{{ web_sites_enabled }}"
  become: true
  notify: reload apache2 config
